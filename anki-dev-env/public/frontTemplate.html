<script>
  function evalCodeBlock(selector) {
    const anki_data = window.anki_data || {};
    const html = document.querySelector(selector).innerText.trim();
    const code = new DOMParser().parseFromString(html.replace(/<br>/g, "\n").trim(), "text/html")
      .documentElement.textContent;
    const fn = eval(code);
    window.anki_data = fn(anki_data);
  }
  function log(...args) {
    console.log(...args);
    const content = document.querySelector(".modal .content");
    const el = document.createElement("div");
    el.innerHTML = args.join(" ");
    content.appendChild(el);
    openModal();
  }
  function evalFront() {
    try {
      evalCodeBlock(".code.front");
    } catch (error) {
      log(`Error onFront: ${error.message}`);
    }
  }
  function evalBack() {
    try {
      evalCodeBlock(".code.back");
    } catch (error) {
      log(`Error onBack: ${error.message}`);
    }
  }
  function openModal() {
    const consoleDiv = document.querySelector(".modal-container");
    consoleDiv.style.display = "flex";
  }
  function closeModal() {
    const consoleDiv = document.querySelector(".modal-container");
    const content = document.querySelector(".modal .content");
    while (content.firstChild) {
      content.removeChild(content.firstChild);
    }
    consoleDiv.style.display = "none";
  }
</script>
<div class="code-blocks">
  <div class="code front">{{onFront}}</div>
  <div class="code back">{{onBack}}</div>
</div>
<div class="modal-container">
  <div class="modal">
    <div class="content"></div>
    <button onclick="closeModal()">Close</button>
  </div>
</div>
<div class="card-content">
  <div id="front" class="card">{{Front}}</div>
  <script>
    evalFront();
  </script>
</div>
