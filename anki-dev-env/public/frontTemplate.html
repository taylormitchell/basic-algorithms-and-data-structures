<script>
  function evalCallbackCodeblock(selector, ...args) {
    const anki_data = window.anki_data || {};
    const html = document.querySelector(selector).innerText.trim();
    const code = new DOMParser().parseFromString(html.replace(/<br>/g, "\n").trim(), "text/html")
      .documentElement.textContent;
    try {
      const fn = eval(code);
      return fn(...args);
    } catch (error) {
      log(`Error evaluating code at "${selector}": ${error.message}`);
    }
  }
  function log(...args) {
    console.log(...args);
    const content = document.querySelector(".modal .content");
    const el = document.createElement("div");
    el.innerHTML = args.join(" ");
    content.appendChild(el);
    openModal();
  }
  function evalFront() {
    const el = evalCallbackCodeblock(".code.front", getProps());
    if (el) {
      document.querySelector("#front").appendChild(el);
    }
  }
  function evalBack() {
    const el = evalCallbackCodeblock(".code.back", getProps());
    if (el) {
      document.querySelector("#back").appendChild(el);
    }
  }
  function getProps() {
    if (!window.props) {
      window.props = evalCallbackCodeblock(".code.props");
    }
    return window.props;
  }
  function openModal() {
    const consoleDiv = document.querySelector(".modal-container");
    consoleDiv.style.display = "flex";
  }
  function closeModal() {
    const consoleDiv = document.querySelector(".modal-container");
    const content = document.querySelector(".modal .content");
    while (content.firstChild) {
      content.removeChild(content.firstChild);
    }
    consoleDiv.style.display = "none";
  }
</script>
<div class="code-blocks">
  <div class="code front">{{onFront}}</div>
  <div class="code back">{{onBack}}</div>
  <div class="code props">{{setProps}}</div>
</div>
<div class="modal-container">
  <div class="modal">
    <div class="content"></div>
    <button onclick="closeModal()">Close</button>
  </div>
</div>
<div class="card-content">
  <div id="front" class="card"></div>
  <script>
    evalFront();
  </script>
</div>
